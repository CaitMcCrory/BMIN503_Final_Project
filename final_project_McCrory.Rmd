---
title: "BMIN503/EPID600 Project Template"
author: "Your Name"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

```{r global options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(readr)
install.packages("tableone")
library(tableone)
``` 

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

Due to a rise in Chlamydia infections over the past decade, the importance of routine STI testing has been emphasized. Access to healthcare facilities may deter some folks from receiving routine testings and will be investigated in this project. Using publicly available data through the City of Chicago, we will be analyzing the Chlamydia rates across the cities neighborhoods to see if there is a correlation with location. I have consulted with the following faculty on my project and discussed:
1. Dr. Kate Wallis - advised me to look for potential racial disparities as is associated with the neighborhood demographics in the city of Chicago.

2. Dr. Alison Buttenheim - Discussed what kinds of analysis I could look at that are useful with rates of tesitng. We discussed difficulties there might be in mapping if the geographic data isn't already in the data set and other options to continue with an interesting project. 

3. Dr. Frances Shofer - Still waiting for feedback

The github repository for this project can be found here: https://github.com/CaitMcCrory/BMIN503_Final_Project


### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Over the past X years, chlamydia rates have gone up X%. Chlamydia is a sexually transmitted infection (STI) that is oftentimes asymptomatic which is thought to encourage further spread. According to ___ 50% of men and 80% of women are asymptomatic. Chlamydia is known to cause some harmful side effects including pelvic inflammatory disease and which sometimes leads to infertilty. Fortunately, chlamydia can be treated with antibiotics when it is detected. Detection of chlamydia requires STI testing between partners. Improving rates of STI testing involves health communication, access to health care, and risk communication. In this project we aim to give the context of chlamydia in Chicago to inform future interventions. This project is of interdisciplinary nature seeing that there is data analytics, healthcare access, behavioral economics, and provider interactions components to it. 



### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

>>Data
> The data used here is from the city of Chicago open access health data. The data includes cases, incidence + 95% confidence intervals, community area number, and commnity area name. These data are available for both males and females from 2000-2014 in separate but mirrored data frames. For the purposes of this project, the data will be cleaned and analyzed to descibe trends in incidence by sex and by neighborhood in their own respective sections below:

>> Data Cleaning
>First we are calling in data.

```{r}
#raw data for males will be male.chlm and raw data for females will be female.chlm
male.chlm.url <- url("https://data.cityofchicago.org/api/views/35yf-6dy3/rows.csv?accessType=DOWNLOAD")
male.chlm <- read_csv(male.chlm.url)

female.chlm.url <- url("https://data.cityofchicago.org/api/views/bz6k-73ti/rows.csv?accessType=DOWNLOAD")
female.chlm <- read_csv(female.chlm.url)
```  

>> Second we clean the data and isolate variables into new data frames with the neccessary variables for further analysis. We exclude the 95% confidence intervals here and are exclusively reviewing incidence rates with their point estimate. 

```{r}
#this r-chunk will be the cleaning/set up for making table one which I am stil deciding how to set up
```

```{r}
#This data cleaning r-chunk will set up the dataframes for part 1 of the data analysis
#removing confidence intervals and cases
#creating a data frame that is just chicago aggregate data for incidence rates + removing community area and commuity area name so we can make a bar plot (note to self incase I forget, chicago's community area is 88 and is the entire city of chicago as the community area name)
chi.female.incid <- female.chlm %>%
  dplyr::filter(`Community Area Name` == "Chicago") %>%
  dplyr::select(`Incidence Rate 2000`, 
                `Incidence Rate 2001`, 
                `Incidence Rate 2002`, 
                `Incidence Rate 2003`, 
                `Incidence Rate 2004`, 
                `Incidence Rate 2005`, 
                `Incidence Rate 2006`,
                `Incidence Rate 2007`, 
                `Incidence Rate 2008`, 
                `Incidence Rate 2009`, 
                `Incidence Rate 2010`, 
                `Incidence Rate 2011`, 
                `Incidence Rate 2012`, 
                `Incidence Rate 2013`, 
                `Incidence Rate 2014`) %>%
  rename(`2000` = `Incidence Rate 2000`,
         `2001` = `Incidence Rate 2001`,
         `2002` = `Incidence Rate 2002`,
         `2003` = `Incidence Rate 2003`,
         `2004` = `Incidence Rate 2004`,
         `2005` = `Incidence Rate 2005`,
         `2006` = `Incidence Rate 2006`,
         `2007` = `Incidence Rate 2007`,
         `2008` = `Incidence Rate 2008`,
         `2009` = `Incidence Rate 2009`,
         `2010` = `Incidence Rate 2010`,
         `2011` = `Incidence Rate 2011`,
         `2012` = `Incidence Rate 2012`,
         `2013` = `Incidence Rate 2013`,
         `2014` = `Incidence Rate 2014`)

chi.male.incid <- male.chlm %>%
  dplyr::filter(`Community Area Name` == "Chicago") %>%
  dplyr::select(`Incidence Rate 2000`, 
                `Incidence Rate 2001`, 
                `Incidence Rate 2002`, 
                `Incidence Rate 2003`, 
                `Incidence Rate 2004`, 
                `Incidence Rate 2005`, 
                `Incidence Rate 2006`,
                `Incidence Rate 2007`, 
                `Incidence Rate 2008`, 
                `Incidence Rate 2009`, 
                `Incidence Rate 2010`, 
                `Incidence Rate 2011`, 
                `Incidence Rate 2012`, 
                `Incidence Rate 2013`, 
                `Incidence Rate 2014`) %>%
  rename(`2000` = `Incidence Rate 2000`,
         `2001` = `Incidence Rate 2001`,
         `2002` = `Incidence Rate 2002`,
         `2003` = `Incidence Rate 2003`,
         `2004` = `Incidence Rate 2004`,
         `2005` = `Incidence Rate 2005`,
         `2006` = `Incidence Rate 2006`,
         `2007` = `Incidence Rate 2007`,
         `2008` = `Incidence Rate 2008`,
         `2009` = `Incidence Rate 2009`,
         `2010` = `Incidence Rate 2010`,
         `2011` = `Incidence Rate 2011`,
         `2012` = `Incidence Rate 2012`,
         `2013` = `Incidence Rate 2013`,
         `2014` = `Incidence Rate 2014`)

#flipping the data frames so they can be plotted and analyzed
chi.female.flipped <- t(chi.female.incid) 
chi.female.flipped <- as.data.frame(chi.female.flipped)
#renaming V1 to be meaningful
colnames(chi.female.flipped) <- "Incidence"
chi.female.flipped <- rownames_to_column(chi.female.flipped, var = "year")

#this code mirrors what we did above to the female sheets
chi.male.flipped <- t(chi.male.incid) 
chi.male.flipped <- as.data.frame(chi.male.flipped)

colnames(chi.male.flipped) <- "Incidence"
chi.male.flipped <- rownames_to_column(chi.male.flipped, var = "year")

#unclear if I need to use this code yet ggarange()
#adding sex as a variable to do a longitudinal plot and maybe linear regression
chi.female.incid1 <- chi.female.flipped %>%
  dplyr::mutate(sex = "female")

chi.male.incid1 <- chi.male.flipped %>%
  dplyr::mutate(sex = "male")

chi.annual.rates.sex <- bind_rows(chi.female.incid1, chi.male.incid1)
```

```{r}
#this data cleaning r-chunk will set up the dataframes for part 2 of data analysis
#join the dataframes longways 79 community areas
#creating our new dataframes to do longitudinal analysis of incidence rates
#female dataframe
incid.female <- female.chlm %>%
  dplyr::select(`Incidence Rate 2000`, `Incidence Rate 2001`, `Incidence Rate 2002`, `Incidence Rate 2003`, `Incidence Rate 2004`, `Incidence Rate 2005`, `Incidence Rate 2006`, `Incidence Rate 2007`, `Incidence Rate 2008`, `Incidence Rate 2009`, `Incidence Rate 2010`, `Incidence Rate 2011`, `Incidence Rate 2012`, `Incidence Rate 2013`, `Incidence Rate 2014`, `Community Area`, `Community Area Name`) %>% 
   dplyr::rename(
     rate_00 = `Incidence Rate 2000`, 
     rate_01 = `Incidence Rate 2001`,
     rate_02 = `Incidence Rate 2002`, 
     rate_03 = `Incidence Rate 2003`, 
     rate_04 = `Incidence Rate 2004`, 
     rate_05 = `Incidence Rate 2005`, 
     rate_06 = `Incidence Rate 2006`,
     rate_07 = `Incidence Rate 2007`, 
     rate_08 = `Incidence Rate 2008`, 
     rate_09 = `Incidence Rate 2009`, 
     rate_10 = `Incidence Rate 2010`, 
     rate_11 = `Incidence Rate 2011`, 
     rate_12 = `Incidence Rate 2012`, 
     rate_13 = `Incidence Rate 2013`, 
     rate_14 = `Incidence Rate 2014`) %>% 
  dplyr::mutate(sex = "female")

#male dataframe
incid.male <- male.chlm %>%
  dplyr::select(`Incidence Rate 2000`, `Incidence Rate 2001`, `Incidence Rate 2002`, `Incidence Rate 2003`, `Incidence Rate 2004`, `Incidence Rate 2005`, `Incidence Rate 2006`, `Incidence Rate 2007`, `Incidence Rate 2008`, `Incidence Rate 2009`, `Incidence Rate 2010`, `Incidence Rate 2011`, `Incidence Rate 2012`, `Incidence Rate 2013`, `Incidence Rate 2014`, `Community Area`, `Community Area Name`) %>% 
  dplyr::rename(
    rate_00 = `Incidence Rate 2000`, 
    rate_01 = `Incidence Rate 2001`, 
    rate_02 = `Incidence Rate 2002`, 
    rate_03 = `Incidence Rate 2003`, 
    rate_04 = `Incidence Rate 2004`,
    rate_05 = `Incidence Rate 2005`, 
    rate_06 = `Incidence Rate 2006`, 
    rate_07 = `Incidence Rate 2007`, 
    rate_08 = `Incidence Rate 2008`, 
    rate_09 = `Incidence Rate 2009`, 
    rate_10 = `Incidence Rate 2010`, 
    rate_11 = `Incidence Rate 2011`, 
    rate_12 = `Incidence Rate 2012`, 
    rate_13 = `Incidence Rate 2013`, 
    rate_14 = `Incidence Rate 2014`) %>% 
  dplyr::mutate(sex = "male")
#rates are labeled by their year (ie. 2000 is rate_00, 2001 is rate_01...)
#Note to self: since this is how the incidence rates are labeled in the df, you will need to rename the column names in the bar chart to be 2000, 2001, 2002.....

#join them longways 79 community areas 
##chlm <- inner_join(female.chlm,male.chlm,by="Community Area")
### using bind_rows will give you a "long table" instead of a "wide table" which is what I was trying to do initially (this will be useful for capstone data as well)
incid.rates.clean <- bind_rows(incid.female, incid.male)
#I think i need to create a column that is a proprotion by gender for the overall chicago rates
chicago.annual.rates <- incid.rates.clean %>%
  filter(`Community Area Name` == "Chicago") %>%
  select(rate_00,
         rate_01,
         rate_02,
         rate_03,
         rate_04,
         rate_05,
         rate_06,
         rate_07,
         rate_08,
         rate_09,
         rate_10,
         rate_11,
         rate_12,
         rate_13,
         rate_14,
         sex)
 

sums <- colSums(chicago.annual.rates[, 1:15], na.rm = TRUE)
chicago.annual.rates <- bind_rows(chicago.annual.rates, sums)
```

>> Description of Variables 

```{r}
#This is where I will be putting the table one for my project but I haven't done that yet.
## Vector of variables to summarize
var.t1 <- c("Community Area Name", "Sex", "Incidence")
## Vector of categorical variables that need transformation
catVars.t1 <- c("Community Area Name", "Sex", "Incidence")
## Create a TableOne object
table1 <- CreateTableOne(vars = var.t1, data = chi.annual.rates.sex, factorVars = catVars.t1)
table1
```

>>> Part 1: Chlamydia Incidence By Sex
>> Part 1a - Graphing

```{r}
#plotting
ggplot(data=chi.annual.rates.sex, aes(x = year, y = Incidence, color = sex)) +
  geom_point() +
  geom_line() +
  ggtitle("Chlamydia Incidence of Chicago in 2000") 

```

>> Part 1b - Wilcoxon Rank Sum Test 

```{r}
#checking for normality with histograms
hist(chi.annual.rates.sex$Incidence)
#not normal distribution
wilcox.test(data = chi.annual.rates.sex, `Incidence` ~ `sex`)
#p<0.05
#running means for each sex for the results section
mean(chi.male.incid1$Incidence)
mean(chi.female.incid1$Incidence)
```

>>> Part 2: Geography of Chlamydia in Chicago  
>> Part 1a - Some sort of graphical representation of neighborhoods idk yet

```{r}
#I think I need to do a row sum to get per community area levels
summary(incid.rates.clean)
```

>> Part 1b - ANOVA by neighborhood

```{r}

```

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
>>> Part 1: Chlamydia Incidence by Sex
>> Part 1a - Graphing
> Throughout the 14 year data collection period, chlamydia incidence was higher in women. 
>> Part 1b - Wilcoxon Rank Sum Test
> The average incidence rates of chlamydia is significantly higher in females than in males in Chicago between the years of 2000-2014 (W = 225, p = 1.289e-08). The average incidence rate in males over the 14 year period is 934.2533 per 100,000 as compared to 2420.013 per 100,000 in females over the same period. 

>>> Part 2: Geography of Chlamydia in Chicago  
>> Part 1a - Some sort of graphical representation of neighborhoods idk yet
>> Part 1b - ANOVA by neighborhood


>>>Conclusions
>> The 